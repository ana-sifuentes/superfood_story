
<html lang="en">

<meta name="viewport" content="width=device-width, initial-scale=1" />

<head>
    <meta charset="UTF-8">
    <title> SUPERFOOD STORY </title>
</head>



<style>

@font-face {
  font-family: VCR_OSD_MONO;
  src: url("assets/VCR_OSD_MONO_1.001.ttf");
}

/*****************************************************************/
/* MENU */

	.menu.wrapper{
		width:100%;
		height:70px;
		margin-top:10px;
		font-family: 'VCR_OSD_MONO';
	}


	.menu.main{
	 	float: left;
  width: 18%;
    		padding: 0px 1%;
    		font-size: 28px;
    		text-align: left;
		font-weight: 800;
	}

	.menu.spacer{
    		float: left;
    		width: 44%;
    		height: 1px;
	}

	.menu.item{
    		float: left;
    		width: 8%;
    		margin: 10px 2%;
    		padding: 8px 0px;
    		font-size: 20px;
    		text-align: center;
	}


	a > .menu.item {
		color:black;
	}

	.menu.item.current,
	.menu.item:hover{
		border-bottom:2px solid black;
	}


/*****************************************************************/

/* fonts */

  p{
		font-family: 'VCR_OSD_MONO';
		text-align:center;
	}

	h1, h2, h3, h4, h5, h6 {
		font-family: 'VCR_OSD_MONO';
	}

/*****************************************************************/
/* GAME */

*{
    padding: 0;
    margin: 0;
    overflow-x: hidden;
}

#character{
    width: 80px;
    height: 100px;
    background-image:url("assets/chia_seed.png");
    position:relative;
    background-repeat: no-repeat;
    background-size: contain;
    left:20px;
    top: 230px;
}

.animate{
    animation: jump 0.3s linear;
}


@keyframes jump{
    0%{top: 230px;}
    30%{top: 130px;}
    70%{top: 130px;}
    100%{top: 230px;}
}

.enemy{
    width: 30px; /*20*/
    height: 20px;
    position: relative;
    top: 205px;
    left: 110%;
    display: none;
    background-repeat: no-repeat;
    background-size: contain;
    background-image:url("assets/fireball.png");
    animation: animation_points 2s infinite linear;
}


.point{
    width: 30px;
    height: 30px;
    background-repeat: no-repeat;
    background-size: contain;
    background-image:url('game assets/coin_rotation_gif.gif');
    position: relative;
    top: 80px;
    left: 110%;
    display: none;
    animation: animation_points 1s infinite linear;
}

.point.active, .enemy.active{
  display: block;
}


@keyframes animation_points{
    0%{left: 110%}
    100%{left: -5%}
}



.game{
  width: 100%;
  height: 400px;
  border: 1px solid black;
  margin: auto;
  max-width: 600px;
}





/*****************************************************************/
/* level data */

.level_data{
    width: 100%;
    height: auto;
    border: 1px solid black;
    margin: auto;
    max-width: 600px;
    font-family: 'VCR_OSD_MONO';
    font-size: 20px;
    margin-bottom: 2vh;
    color:#ffffff;
  }

  .level_data.playing{
    color:#000000;
  }

  .level_data > .column{
    width:33%;
    float:left;
  }

  .level_data > .column.level{
    text-align: center;
  }

  .level_data > .column.volume{
    cursor:pointer;
    text-align: right;
    color:#000000;
  }

  .level_data >  .column.volume > .volume_control.on::before{
    content:'ON';
  }

  .level_data >  .column.volume > .volume_control.off::before{
    content:'OFF';
  }


/*****************************************************************/
/* levels */

.levels{
  float: left;
  height: 400px;
  width: 100%;
  position: relative;
  display: none;
  background-position-x: 0%;
  background-size: cover;
  background-repeat: no-repeat;
}

.levels.current{
  display: block;
}

/*welcome screen*/
.levels.current.lvl_0{
  display: block;
  text-align: center;
  background-position-y:100%;
  background-repeat: repeat-y;
  background-size: cover;
  animation: 60s welcome_screen_animation linear alternate infinite;
  background-image: url('game assets/welcome_screen.svg');
}

@keyframes welcome_screen_animation {
    from {
        background-position-y: 100%
    }
    to {
        background-position-y: 0%
    }
}

#welcome_screen > h3{
  font-weight: 900;
  font-size: 50px;
  line-height: normal;
  top: 150px;
  position: relative;
  width: 75%;
  background-color: white;
  margin: auto;
}

#welcome_screen p{
  top: 165px;
  position: relative;
}




/*mesoamerica*/
.levels.current.lvl_1{
  animation: 40s level_animation linear infinite;
  background-image: url('game assets/Level_background_LEVEL 1.svg');
}

/*colonization*/
.levels.current.lvl_2{
  animation: 40s level_animation linear infinite;
  background-image: url('game assets/Level_background_LEVEL 2.svg');
}

/*rediscovery*/
.levels.current.lvl_3{
  animation: 40s level_animation linear infinite;
  background-image: url(https://via.placeholder.com/2000x400/FF0000/000000?text=LEVEL_3);
}

/*modernity*/
.levels.current.lvl_4{
  animation: 40s level_animation linear infinite;
  background-image: url(https://via.placeholder.com/2000x400/0000FF/000000?text=LEVEL_4);
}


@keyframes level_animation {
    from {
        background-position-x: 0%
    }
    to {
        background-position-x: 100%
    }
}


/*GAME ENDED*/
.levels.current.lvl_5{
  display: block;
  background-position-x: 52%;
  background-image: url(https://via.placeholder.com/600x400?text=GAME_END);
}


/***********************************************************************/

.mobile_button{
    width: 50%;
    max-width: 600px;
    text-align: center;
    cursor: pointer;
    border: 1px solid black;
    height: 40px;
    font-family: 'VCR_OSD_MONO';
    padding: 4vh 0px 2vh 0px;
    background-color: #BEBFB9;
    margin: 2vh auto;
    font-size: 25px;
}

.mobile_button:hover{
  background-color: #E1E1DF;
}

/***********************************************************************/

/* MOBILE */
@media only screen and (max-width: 450px) {

  .game{  max-width: 300px;}
  .levels.current.lvl_0{ animation: 20s welcome_screen_animation linear alternate infinite;}
  #welcome_screen > h3{width: 100%}

}



</style>







<body>
  <div class="menu wrapper">

    <div class="menu main" id="main_logo">
    <p> SUPERFOOD <BR> STORY </p>
    </div>

	<div class="menu spacer"> <p></p></div>


	<a href="/superfood_story/index">
	<div class="menu item current">
    	<p> GAME  </p>
        </div>
	</a>

	<a href="/superfood_story/article">
	<div class="menu item ">
    	<p> ARTICLE  </p>
    	</div>
	</a>

	<a href="/superfood_story/article#credits">
	<div class="menu item">
    	<p> CREDITS </p>
    	</div>
	</a>

  </div>




  <div class="level_data">

    <div class="column score">
      SCORE:
      <span id="score"> </span>
    </div>

    <div class="column level">
      LEVEL <span id="lvl_number"></span>
    </div>


    <div class="column volume">
      AUDIO:
      <span class="volume_control off" id="volume_control"></span>
    </div>

  </div>


  <div class="game">

	        <div id="welcome_screen" class="levels lvl_0 current">

              <h3>SUPERFOOD STORY</h3>
		          <p> PRESS SPACE </p>

	        </div>


	         <div id="levels" class="levels lvl_1">
             <div id="character"></div>
             <div id="enemy" class="enemy"></div>
             <div id="point" class="point showing"></div>
	         </div>

  </div>




    <div id="mobile_button" class="mobile_button">
        SPACE
    </div>





	</div>
	</div>

</body>




<!---LOAD JQUERY--->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!--GAME CODE---->
<script>

  //initial code based on: https://github.com/Beat0154

////////////////////////////////////////////////////////////////////////

  //variables
  let score = 0;
  let game_stage = 0;
  var game_ended = false;


  //music files

  var audio_on = false;
  const intro_music = new Audio('game assets/aztec fall.wav');
  intro_music.loop = true;


////////////////////////////////////////////////////////////////////////
//user clicks space or button

    //when the user clicks
    document.body.onkeyup = function(e){
        if(e.keyCode == 32){

          if(game_stage == 0){
             start_game();
             console.log('the game begins!');
          }

          if(game_stage > 0 && game_stage <5){
             jump();
          }

          if(game_stage == 5){
            location.reload();
          }

      }
    }

  		$('#mobile_button').click(function(){

        if(game_stage == 0){
           start_game();
           console.log('the game begins!');
        }

        if(game_stage > 0 && game_stage <5){
           jump();
        }

        if(game_stage == 5){
          location.reload();
        }

      });

////////////////////////////////////////////////////////////////////////
//user clicks on the audio control

    	$('.column.volume').click(function(){

        //mute
        if( $('#volume_control').hasClass('on')  ){

          $('#volume_control').removeClass('on').addClass('off');

          intro_music.muted = true;
          audio_on = false;

        }
        else{ //unmute
          $('#volume_control').removeClass('off').addClass('on');

          audio_on = true;
          play_song(game_stage);

        }
      });



/////////////////////////////////////////////////////////////////////////////////////////////////////////
//functions

    //game starts
    function start_game(){

      //remove the title screen
      $('#welcome_screen').removeClass('current');

      //show levels screen
      $("#levels").addClass('current');

      //show game data
      $('.level_data').addClass('playing');
      $("#lvl_number").html(game_stage);

      //update variables
      game_stage = 1;
      score = 0;
      console.log('LEVEL: '+game_stage);

      //start the points and enemies functions
      random_point();
      random_enemy();
      check_points();

      //change songs
      play_song(game_stage);

      //start the loop to change lvls
      change_lvl();



    }


    //start levels
    function change_lvl(){


        console.log('changing levels');

        //change lvls every 40 seconds
        var change_lvl_interval = window.setInterval(function(){

              //remove previous lvl
              $("#levels").removeClass('lvl_'+game_stage);

              //add +1 stage
              game_stage = game_stage+1;
              console.log('LEVEL: '+game_stage);

              //update music, lvl class and lvl display
              play_song(game_stage);
              $("#levels").addClass('lvl_'+game_stage);
              $("#lvl_number").html(game_stage);


              //if its above lvl 5, the game is over
              if(game_stage >= 5){

                  game_stage = 5;
                  clearInterval(change_lvl_interval);
                  end_game();

              }

        }, 40000);

    }




    //player jumps
    function jump(){

      if(character.classList == "animate"){return}
        character.classList.add("animate");
        setTimeout(function(){
          character.classList.remove("animate");
        },300);
    }


    function check_points(){

      let character_position;
      let point_position;
      let enemy_position;

      setInterval(function() {

        character_position  = $('#character').position();
        point_position = $('#point').position();
        enemy_position = $('#enemy').position();


        //if the user touches the point
        if( character_position.top < 230 && point_position.left >= 20 && point_position.left <= 100){
          score++;
        }

        //check if the user colllides with the enemy

        if( character_position.top == 230 && enemy_position.left >= 20 && enemy_position.left<= 100){
          score--;

          //prevent negative score
         if(score <0 ){
            score =0;
          }
        }

        //update score
        $('#score').html(score);

      },10);

    }

    function random_point() {


      //define frequency
      var frequency = 0;


      switch(game_stage){
        case 1:default:
        frequency = 99; // 90%
        break;

        case 2:
        frequency = 75; // 75%
        break;

        case 3:
        frequency = 50; // 50%
        break;

        case 4:
        frequency = 25; // 25%
        break;


      }

      //randomly display the point every 1 second
      setInterval(function() {

          let num = Math.floor((Math.random() * 100) + 1);

          if(num < frequency ){
            $('#point').addClass("active");
          }
          else{
            $('#point').removeClass("active");
          }

       },1000);

    }



    function random_enemy() {

          //define frequency
          var frequency = 0;


          switch(game_stage){
            case 1:default:
            frequency = 25; // 25%
            break;

            case 2:
            frequency = 50; // 50%
            break;

            case 3:
            frequency = 75; // 75%
            break;

            case 4:
            frequency = 99; // 99%
            break;


          }



          //randomly display the point every 1 second
          setInterval(function() {

            let num = Math.floor((Math.random() * 100) + 1);

            if(num < frequency ){
              $('#enemy').addClass("active");
            }
            else{
              $('#enemy').removeClass("active");
            }

          },2000);

        }



    function play_song(game_stage){

      //mute all songs
      //if the user has put audio on
      if(audio_on == true){

        //depending on the level, play according song
        switch (game_stage) {
          case 0: case 5:
            intro_music.muted = false;
            intro_music.play();
            break;

          case 1: case 2: case 3: case 4:
            intro_music.muted = true;
            break;
          default:

        }
      }

    }


    function end_game(){

      //hide characters, points and enemies
       $('#character').hide();
       $('#enemy').hide();
       $('#point').hide();


       $('.column.level').html('GAME OVER');
        console.log('the game is over');
        game_ended = true;
    }







</script>
</html>
