<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
  <style>
    @font-face {
      font-family: VCR_OSD_MONO;
      src: url("vga/VCR_OSD_MONO_1.001.ttf");
    }
  </style>
</head>
<body>

<script>
var GAME_WIDTH = 960;
var GAME_HEIGHT = 540;

var config = {
  type: Phaser.AUTO,
  width: GAME_WIDTH,
  height: GAME_HEIGHT,
  physics: {
    default: 'arcade',
    arcade: {
      gravity: { y: 800 }
    }
  }
};

var stage = 0;
var game = new Phaser.Game(config);

var titleScene = new Phaser.Scene('titleScene');
titleScene.preload = function() {
  this.load.image('title_bg', 'vga/welcome_screen.png');
  this.load.audio('title_bgm', 'vga/superfood_story_theme.wav')
}

titleScene.create = function() {
  // audio
  this.bgm = this.sound.add('title_bgm');
  this.bgm.loop = true;

  // camera
  this.cameras.main.setBackgroundColor('#fff');
  
  // input
  this.keyboard = this.input.keyboard.createCursorKeys();
  this.spacePressed = false;

  // bg
  this.scrollingBackground = this.add.tileSprite(GAME_WIDTH / 2, GAME_HEIGHT / 2, GAME_WIDTH, GAME_HEIGHT, 'title_bg');

  // text
  var smallTextStyles = {
    color: '#000',
    fontSize: 40, 
    fontFamily: 'VCR_OSD_MONO',
    boundsAlignH: 'center'
  };

  var bigTextStyles = {
    color: '#000',
    fontSize: 100, 
    fontFamily: 'VCR_OSD_MONO',
    boundsAlignH: 'center'
  };

  this.title = this.add.text(GAME_WIDTH / 2, 100, 'SUPER FOOD STORY', bigTextStyles);
  this.continue = this.add.text(GAME_WIDTH / 2, 500, 'Press SPACE to start', smallTextStyles);

  this.title.setOrigin(0.5, 0.5);
  this.continue.setOrigin(0.5, 0.5);

  // blink text
  this.blinkTicks = 0;
}

titleScene.update = function() {
  if (!this.bgm.isPlaying) {
    this.bgm.play();
  }

  this.scrollingBackground.tilePositionY += 0.25;

  this.blinkTicks++;

  if (this.blinkTicks > 150) {
    this.blinkTicks = 0;
    this.continue.visible = !this.continue.visible;
  }

  if (this.keyboard.space.isDown) {
    this.spacePressed = true;
  }

  if (this.spacePressed && this.keyboard.space.isUp) {
    this.bgm.stop();
    this.spacePressed = false;
    this.scene.switch('menuScene1');
  }
}
 
var menuScene1 = new Phaser.Scene('menuScene1');
menuScene1.preload = function() { _menuPreload(this); };
menuScene1.create = function() { _menuCreate(this); };
menuScene1.update = function() { _menuUpdate(this); };

var menuScene2 = new Phaser.Scene('menuScene2');
menuScene2.preload = function() { _menuPreload(this); };
menuScene2.create = function() { _menuCreate(this); };
menuScene2.update = function() { _menuUpdate(this); };

var menuScene3 = new Phaser.Scene('menuScene3');
menuScene3.preload = function() { _menuPreload(this); };
menuScene3.create = function() { _menuCreate(this); };
menuScene3.update = function() { _menuUpdate(this); };

var menuScene4 = new Phaser.Scene('menuScene4');
menuScene4.preload = function() { _menuPreload(this); };
menuScene4.create = function() { _menuCreate(this); };
menuScene4.update = function() { _menuUpdate(this); };

var menuScene5 = new Phaser.Scene('menuScene5');
menuScene5.preload = function() { _menuPreload(this); };
menuScene5.create = function() { _menuCreate(this); };
menuScene5.update = function() { _menuUpdate(this); };

var menuScene6 = new Phaser.Scene('menuScene6');
menuScene6.preload = function() { _menuPreload(this); };
menuScene6.create = function() { _menuCreate(this); };
menuScene6.update = function() { _menuUpdate(this); };

var STAGE_NAMES = [
  'MESOAMERICA',
  'COLONIZATION',
  'LOST',
  'REDISCOVERY',
  'MODERN TIMES',
  'YOU WIN'
];

var STAGE_BLURBS = [
  'COLLECT FOODS!',
  'ESCAPE THE FIRE!',
  '',
  'COLLECT RESEARCH + AVOID THE PETS',
  'COLLECT MONEY',
  'THANKS FOR PLAYING'
];

var STAGE_COINS = [
  { add: true, x: 600, y: 320 },
  { add: false, x: 0, y: 0 },
  { add: true, x: 600, y: 320 },
  { add: true, x: 550, y: 320 },
  { add: true, x: 600, y: 320 },
  { add: false, x: 0, y: 0 }
]

var STAGE_BOMBS = [
  { add: false, x: 0, y: 0 },
  { add: true, x: 600, y: 320 },
  { add: false, x: 0, y: 0 },
  { add: true, x: 650, y: 320 },
  { add: false, x: 0, y: 0 },
  { add: false, x: 0, y: 0 }
]

function _menuPreload(scene) {
  if (stage === 0) {
    scene.load.spritesheet('lv1_coin', 'vga/lvl1/food.png', { frameWidth: 60, frameHeight: 80 });
  } else if (stage === 1) {
    scene.load.spritesheet('lv2_bomb', 'vga/lvl2/fire.png', { frameWidth: 90, frameHeight: 55 });
  } else if (stage === 2) {
    scene.load.image('lv3_coin', 'vga/lvl3/uknown.png');
  } else if (stage === 3) {
    scene.load.spritesheet('lv4_coin', 'vga/lvl4/research.png', { frameWidth: 80, frameHeight: 90 });
    scene.load.spritesheet('lv4_bomb', 'vga/lvl4/chia-pet.png', { frameWidth: 85, frameHeight: 55 });
  } else if (stage === 4) {
    scene.load.spritesheet('lv5_coin', 'vga/lvl5/coin.png', { frameWidth: 55, frameHeight: 45 });
  }
  
  scene.load.spritesheet('player', 'vga/chia.png', { frameWidth: 105, frameHeight: 120 });
}

function _menuCreate(game) {
  // camera
  game.cameras.main.setBackgroundColor('#fff');
  
  // input
  game.keyboard = game.input.keyboard.createCursorKeys();
  game.spacePressed = false;

  // text
  var smallTextStyles = {
    color: '#000',
    fontSize: 40, 
    fontFamily: 'VCR_OSD_MONO',
    boundsAlignH: 'center'
  };

  var bigTextStyles = {
    color: '#000',
    fontSize: 60, 
    fontFamily: 'VCR_OSD_MONO',
    boundsAlignH: 'center'
  };

  var level_id = stage === 2 ? '?' : (stage + 1);

  game.level = game.add.text(GAME_WIDTH / 2, 30, 'Level ' + level_id, smallTextStyles);
  game.stageName = game.add.text(GAME_WIDTH / 2, 90, STAGE_NAMES[stage], bigTextStyles);
  game.stageBlurb = game.add.text(GAME_WIDTH / 2, 430, STAGE_BLURBS[stage], stage === 3 ? smallTextStyles : bigTextStyles);
  game.continue = game.add.text(GAME_WIDTH / 2, 490, 'Press SPACE to start', smallTextStyles);

  game.level.setOrigin(0.5, 0.5);
  game.stageName.setOrigin(0.5, 0.5);
  game.stageBlurb.setOrigin(0.5, 0.5);
  game.continue.setOrigin(0.5, 0.5);

  // sprites
  game.sprites = game.physics.add.staticGroup();
  game.player = game.sprites.create(stage === 5 ? GAME_WIDTH / 2 - 52 : 300, 300, 'player');

  if (STAGE_COINS[stage].add) {
    game.coins = game.sprites.create(STAGE_COINS[stage].x, STAGE_COINS[stage].y, 'lv' + (stage + 1) + '_coin');
  }

  if (STAGE_BOMBS[stage].add) {
    game.bombs = game.sprites.create(STAGE_BOMBS[stage].x, STAGE_BOMBS[stage].y, 'lv' + (stage + 1) + '_bomb');
  }

  game.anims.create({
    key: 'idle',
    frames: game.anims.generateFrameNumbers('player', { start: 9, end: 9 }),
    frameRate: 10,
    repeat: -1
  });

  if (stage === 0) {
    game.anims.create({
      key: 'coin1',
      frames: game.anims.generateFrameNumbers('lv1_coin', { start: 0, end: 11 }),
      frameRate: 10,
      repeat: -1
    });
  } else if (stage === 1) {
    game.anims.create({
      key: 'bomb2',
      frames: game.anims.generateFrameNumbers('lv2_bomb', { start: 0, end: 2 }),
      frameRate: 10,
      repeat: -1
    });
  } else if (stage === 3) {
    game.anims.create({
      key: 'coin4',
      frames: game.anims.generateFrameNumbers('lv4_coin', { start: 0, end: 3 }),
      frameRate: 10,
      repeat: -1
    });

    game.anims.create({
      key: 'bomb4',
      frames: game.anims.generateFrameNumbers('lv4_bomb', { start: 0, end: 1 }),
      frameRate: 10,
      repeat: -1
    });
  } else if (stage === 4) {
    game.anims.create({
      key: 'coin5',
      frames: game.anims.generateFrameNumbers('lv5_coin', { start: 0, end: 5 }),
      frameRate: 10,
      repeat: -1
    });
  }

  // blink text
  game.blinkTicks = 0;
}

function _menuUpdate(scene) {
  // animations
  scene.player.anims.play('idle', true);
  
  if (STAGE_COINS[stage].add && stage !== 2) {
    scene.coins.anims.play('coin' + (stage + 1), true);
  }

  if (STAGE_BOMBS[stage].add) {
    scene.bombs.anims.play('bomb' + (stage + 1), true);
  }

  // blink
  scene.blinkTicks++;

  if (scene.blinkTicks > 150) {
    scene.blinkTicks = 0;
    scene.continue.visible = !scene.continue.visible;
  }

  // inputs
  if (scene.keyboard.space.isDown) {
    scene.spacePressed = true;
  }

  if (scene.spacePressed && scene.keyboard.space.isUp) {
    stage++;
    scene.spacePressed = false;

    if (stage < 6) {
      scene.scene.switch('playScene' + stage);
    } else {
      stage = 0;
      scene.scene.switch('titleScene');
    }
  }
}

var jumpSpeeds = [
  -250, -250, -250, -250, -250,
  -260, -270, -280, -290, -300, 
  -320, -340, -360, -380, -400,
  -420, -440, -460, -470, -480
  -490, -500
];

var plats = {};
plats['lv1_plats'] = [
      0,   520,  1040,  1560,  2080,
   2900,  3640,  4160,  4680,
   5200,  6240,  6760,  7280,
   7800,  8840,  9880,
  10400, 10920, 11440, 11960, 12480
];
plats['lv2_plats'] = [
      0,   520,  1040,  1560,  2080,
   2900,  3640,  4160,  4680,
   5200,  6240,  6760,  7280,
   7800,  8840,  9880,
  10400, 10920, 11440, 11960, 12480
];
plats['lv3_plats'] = [
      0,   520,  1040,  1560,  2080,
   2900,  3640,  4160,  4680,
   5200,  6240,  6760,  7280,
   7800,  8840,  9880,
  10400, 10920, 11440, 11960, 12480
];
plats['lv4_plats'] = [
      0,   520,  1040,  1560,  2080,
   2900,  3640,  4160,  4680,
   5200,  6240,  6760,  7280,
   7800,  8840,  9880,
  10400, 10920, 11440, 11960, 12480
];
plats['lv5_plats'] = [
      0,   520,  1040,  1560,  2080,
   2900,  3640,  4160,  4680,
   5200,  6240,  6760,  7280,
   7800,  8840,  9880,
  10400, 10920, 11440, 11960, 12480
];

var coins = {};
coins['lv1_coins'] = [
  600, 1000, 1400, 3000,
  3400, 5000, 6000, 8000,
  9000, 9300, 9900
];
coins['lv2_coins'] = [];
coins['lv3_coins'] = [];
coins['lv4_coins'] = [
  600, 1000, 1400, 3000,
  3400, 5000, 6000, 8000,
  9000, 9300, 9900
];
coins['lv5_coins'] = [
  600, 1000, 1400, 3000,
  3400, 5000, 6000, 8000,
  9000, 9300, 9900
];

var bombs = {};
bombs['lv1_bombs'] = [];
bombs['lv2_bombs'] = [
   900, 1400, 2000,
  3400, 4800,
  9300
];
bombs['lv3_bombs'] = [];
bombs['lv4_bombs'] = [
  900, 1400, 2000,
  3400, 4800,
  9300
];
bombs['lv5_bombs'] = [];

function _playPreload(scene) {
  if (stage === 1) {
    scene.load.image('lv1_sky', 'vga/lvl1/background_sky.png');
    scene.load.image('lv1_bg1', 'vga/lvl1/background_clouds.png');
    scene.load.image('lv1_bg2', 'vga/lvl1/background_mountains.png');
    scene.load.image('lv1_bg3', 'vga/lvl1/background_lake.png');
    scene.load.image('lv1_bg4', 'vga/lvl1/background_chinampas.png');
    scene.load.image('lv1_ground', 'vga/lvl1/background_platform.png');

    scene.load.spritesheet('lv1_coin', 'vga/lvl1/food.png', { frameWidth: 60, frameHeight: 80 });

    scene.load.audio('lv1_bgm', 'vga/lvl1/music.wav');
  } else if (stage === 2) {
    scene.load.image('lv2_sky', 'vga/lvl2/background_sky.png');
    scene.load.image('lv2_bg1', 'vga/lvl2/background_mountains_back.png');
    scene.load.image('lv2_bg2', 'vga/lvl2/background_clouds.png');
    scene.load.image('lv2_bg3', 'vga/lvl2/background_volcano.png');
    scene.load.image('lv2_bg4', 'vga/lvl2/background_mountains_front.png');
    scene.load.image('lv2_ground', 'vga/lvl2/background_platform.png');

    scene.load.spritesheet('lv2_bomb', 'vga/lvl2/fire.png', { frameWidth: 90, frameHeight: 55 });

    scene.load.audio('lv2_bgm', 'vga/lvl2/music.wav');
    scene.load.audio('lv2_sfx_bomb', 'vga/fireball.wav');
  } else if (stage === 3) {
    scene.load.image('lv3_sky', 'vga/lvl3/background_sky.png');
    scene.load.image('lv3_bg2', 'vga/lvl3/background_message.png');
    scene.load.image('lv3_ground', 'vga/lvl3/background_platform.png');
  } else if (stage === 4) {
    scene.load.image('lv4_sky', 'vga/lvl4/background_sky.png');
    scene.load.image('lv4_bg1', 'vga/lvl4/background_clouds.png');
    scene.load.image('lv4_bg2', 'vga/lvl4/background_hills.png');
    scene.load.image('lv4_bg3', 'vga/lvl4/background_grass2.png');
    scene.load.image('lv4_bg4', 'vga/lvl4/background_grass1.png');
    scene.load.image('lv4_ground', 'vga/lvl4/background_platform.png');

    scene.load.spritesheet('lv4_coin', 'vga/lvl4/research.png', { frameWidth: 80, frameHeight: 90 });
    scene.load.spritesheet('lv4_bomb', 'vga/lvl4/chia-pet.png', { frameWidth: 85, frameHeight: 55 });

    scene.load.audio('lv4_bgm', 'vga/lvl4/music.wav');
    scene.load.audio('lv4_sfx_bomb', 'vga/chia-pet.wav');
  } else {
    scene.load.image('lv5_sky', 'vga/lvl5/background_sky.png');
    scene.load.image('lv5_bg1', 'vga/lvl5/background_buildings3.png');
    scene.load.image('lv5_bg2', 'vga/lvl5/background_buildings_2.png');
    scene.load.image('lv5_bg3', 'vga/lvl5/background_buildings1.png');
    scene.load.image('lv5_bg4', 'vga/lvl5/background_details.png');
    scene.load.image('lv5_ground', 'vga/lvl5/background_platform.png');

    scene.load.spritesheet('lv5_coin', 'vga/lvl5/coin.png', { frameWidth: 55, frameHeight: 55 });

    scene.load.audio('lv5_bgm', 'vga/lvl5/music.wav');
  }

  scene.load.spritesheet('player', 'vga/chia.png', { frameWidth: 105, frameHeight: 120 });
  scene.load.audio('sfx_player_jump', 'vga/chia_jump.wav');
  // scene.load.audio('sfx_player_dead', 'vga/chia_dying.wav');
  scene.load.audio('sfx_coin', 'vga/coin.wav');
}

function _playCreate(game) {
  // audio
  if (stage !== 3) {
    game.bgm = game.sound.add('lv' + stage + '_bgm');
    game.bgm.loop = true;
  }
  game.sfx_coin = game.sound.add('sfx_coin');

  if (STAGE_BOMBS[stage - 1].add) {
    game.sfx_bomb = game.sound.add('lv' + stage + '_sfx_bomb');
  }
  game.sfx_jump = game.sound.add('sfx_player_jump');
  // game.sfx_jump = game.sound.add('sfx_player_dead');

  // bg parallax
  game.layers_0 = game.add.tileSprite(GAME_WIDTH / 2, GAME_HEIGHT / 2, GAME_WIDTH, GAME_HEIGHT, 'lv' + stage + '_sky');
  game.layers_0.setScrollFactor(0);
  game.layers_2 = game.add.tileSprite(GAME_WIDTH / 2, GAME_HEIGHT / 2, GAME_WIDTH, GAME_HEIGHT, 'lv' + stage + '_bg2');
  game.layers_2.setScrollFactor(0);
  
  if (stage !== 3) {
    game.layers_1 = game.add.tileSprite(GAME_WIDTH / 2, GAME_HEIGHT / 2, GAME_WIDTH, GAME_HEIGHT, 'lv' + stage + '_bg1');
    game.layers_1.setScrollFactor(0);
    game.layers_3 = game.add.tileSprite(GAME_WIDTH / 2, GAME_HEIGHT / 2, GAME_WIDTH, GAME_HEIGHT, 'lv' + stage + '_bg3');
    game.layers_3.setScrollFactor(0);
    game.layers_4 = game.add.tileSprite(GAME_WIDTH / 2, GAME_HEIGHT / 2, GAME_WIDTH, GAME_HEIGHT, 'lv' + stage + '_bg4');
    game.layers_4.setScrollFactor(0);
  }

  // plats
  game.platforms = game.physics.add.staticGroup();
  plats['lv' + stage + '_plats'].forEach(platX => game.platforms.create(platX, GAME_HEIGHT + 28, 'lv' + stage + '_ground'));

  // items
  game.coins = game.physics.add.staticGroup();
  coins['lv' + stage + '_coins'].forEach(coinX => game.coins.create(coinX, 450, 'lv' + stage + '_coin'));

  game.bombs = game.physics.add.staticGroup();
  bombs['lv' + stage + '_bombs'].forEach(bombX => game.bombs.create(bombX, 520, 'lv' + stage + '_bomb'));

  // player
  game.player = game.physics.add.sprite(50, 450, 'player'); 
  game.physics.add.collider(game.player, game.platforms);
  game.physics.add.overlap(game.player, game.coins, _collectCoin, null, game);
  game.physics.add.overlap(game.player, game.bombs, _bombCollide, null, game);

  game.anims.create({
    key: 'run',
    frames: game.anims.generateFrameNumbers('player', { start: 3, end: 4 }),
    frameRate: 10,
    repeat: -1
  });

  game.anims.create({
    key: 'jump',
    frames: game.anims.generateFrameNumbers('player', { start: 5, end: 6 }),
    frameRate: 10,
    repeat: -1
  });

  game.anims.create({
    key: 'dead',
    frames: game.anims.generateFrameNumbers('player', { start: 1, end: 2 }),
    frameRate: 10,
    repeat: 0
  });

  if (stage === 1) {
    game.anims.create({
      key: 'coin1',
      frames: game.anims.generateFrameNumbers('lv1_coin', { start: 0, end: 11 }),
      frameRate: 10,
      repeat: -1
    });
  } else if (stage === 2) {
    game.anims.create({
      key: 'bomb2',
      frames: game.anims.generateFrameNumbers('lv2_bomb', { start: 0, end: 2 }),
      frameRate: 10,
      repeat: -1
    });
  } else if (stage === 4) {
    game.anims.create({
      key: 'coin4',
      frames: game.anims.generateFrameNumbers('lv4_coin', { start: 0, end: 3 }),
      frameRate: 10,
      repeat: -1
    });

    game.anims.create({
      key: 'bomb4',
      frames: game.anims.generateFrameNumbers('lv4_bomb', { start: 0, end: 1 }),
      frameRate: 10,
      repeat: -1
    });
  } else if (stage === 5) {
    game.anims.create({
      key: 'coin5',
      frames: game.anims.generateFrameNumbers('lv5_coin', { start: 0, end: 5 }),
      frameRate: 10,
      repeat: -1
    });
  }
  
  // ui
  game.gameOverText = game.add.text(GAME_WIDTH / 2, 150, 'Game Over', {color: '#fff', fontSize: 60, fontFamily: 'VCR_OSD_MONO'});
  game.continueText = game.add.text(GAME_WIDTH / 2, 250, 'Press SPACE to restart', {color: '#fff', fontSize: 60, fontFamily: 'VCR_OSD_MONO'});
  game.gameOverText.setOrigin(0.5, 0.5);
  game.continueText.setOrigin(0.5, 0.5);
  game.gameOverText.setShadow(2, 2, 'rgba(0,0,0,0.5)', 0);
  game.continueText.setShadow(2, 2, 'rgba(0,0,0,0.5)', 0);
  game.gameOverText.setScrollFactor(0);
  game.continueText.setScrollFactor(0);
  game.gameOverText.visible = false;
  game.continueText.visible = false;

  // inputs
  game.keyboard = game.input.keyboard.createCursorKeys();

  // camera
  game.cameras.main.setBackgroundColor('#ffffff');
  game.cameras.main.startFollow(game.player, true, 1, 0, -200, 130);

  // game states
  game.gameWin = false;
  game.gameOver = false;
  game.animSetup = false;
  game.awaitTransition = 0;
}

function _playUpdate(scene) {
  // console.log(scene.player.x);

  if (!scene.animSetup) {
    if (STAGE_COINS[stage - 1].add) {
      scene.coins.children.iterate((coin) => coin.anims.play('coin' + stage));
    }
    
    if (STAGE_BOMBS[stage - 1].add) {
      scene.bombs.children.iterate((bomb) => bomb.anims.play('bomb' + stage));
    }

    scene.animSetup = true;
  }

  if (scene.bgm && !scene.bgm.isPlaying) {
    scene.bgm.play();
  }

  if (scene.gameWin) {
    scene.awaitTransition++;
    scene.cameras.main.stopFollow();

    if (scene.awaitTransition >= 500) {
      if (stage !== 3) {
        scene.bgm.stop();
      }
      
      scene.scene.switch('menuScene' + (stage + 1));
      _restart(scene);
    }

    return;
  };

  if (scene.gameOver) {
    scene.gameOverText.visible = true;
    scene.continueText.visible = true;

    scene.player.setVelocity(0, 0);
    
    if (scene.keyboard.space.isDown) {
      _restart(scene);
    }
    
    return;
  }

  // parallax
  scene.layers_2.tilePositionX += 0.3;
  
  if (stage !== 3) {
    scene.layers_1.tilePositionX += 0.05;
    scene.layers_3.tilePositionX += 0.75;
    scene.layers_4.tilePositionX += 0.90;
  }

  // auto move
  scene.player.setVelocityX(400);
  
  // jump
  if (scene.player.body.touching.down) {
    scene.player.anims.play('run', true);
    scene.jumpHeld = 0;
  } else {
    scene.player.anims.play('jump', true);
  }

  if (scene.keyboard.space.isDown && scene.jumpHeld < 20) {
    if (scene.jumpHeld === 0) {
      scene.sfx_jump.play();
    }

    scene.jumpHeld++;
    scene.player.setVelocityY(jumpSpeeds[scene.jumpHeld]);
  }

  if (scene.player.y > 650) {
    scene.gameOver = true;
  }
  
  if (scene.player.x > 10000) {
    scene.gameWin = true;
  }
}

function _restart(game) {
  game.player.x = 50;
  game.player.y = 450;

  game.coins.children.iterate(function (coin) {
    coin.enableBody(false, 0, 0, true, true);
  });

  game.bombs.children.iterate(function (bomb) {
    bomb.enableBody(false, 0, 0, true, true);
  });
  
  game.layers_2.tilePositionX = 0;
  
  if (stage !== 3) {
    game.layers_1.tilePositionX = 0;
    game.layers_3.tilePositionX = 0;
    game.layers_4.tilePositionX = 0;
  }

  game.gameOverText.visible = false;
  game.continueText.visible = false;

  game.jumpHeld = 0;

  game.gameOver = false;
  game.gameWin = false;
  game.animSetup = false;
  game.awaitTransition = 0;
  
  game.cameras.main.startFollow(game.player, true, 1, 0, -200, 130);
}

function _collectCoin(player, coin) {
  this.sfx_coin.play();
  coin.disableBody(true, true);
}

function _bombCollide(player, bomb) {
  bomb.disableBody(true, true);
  this.player.anims.play('dead', true);
  this.sfx_bomb.play();
  this.gameOver = true;
}

var playScene1 = new Phaser.Scene('playScene1');
playScene1.preload = function() { _playPreload(this) };
playScene1.create = function() { _playCreate(this) };
playScene1.update = function() { _playUpdate(this) };

var playScene2 = new Phaser.Scene('playScene2');
playScene2.preload = function() { _playPreload(this) };
playScene2.create = function() { _playCreate(this) };
playScene2.update = function() { _playUpdate(this) };

var playScene3 = new Phaser.Scene('playScene3');
playScene3.preload = function() { _playPreload(this) };
playScene3.create = function() { _playCreate(this) };
playScene3.update = function() { _playUpdate(this) };

var playScene4 = new Phaser.Scene('playScene4');
playScene4.preload = function() { _playPreload(this) };
playScene4.create = function() { _playCreate(this) };
playScene4.update = function() { _playUpdate(this) };

var playScene5 = new Phaser.Scene('playScene5');
playScene5.preload = function() { _playPreload(this) };
playScene5.create = function() { _playCreate(this) };
playScene5.update = function() { _playUpdate(this) };

game.scene.add('titleScene', titleScene);
game.scene.add('menuScene1', menuScene1);
game.scene.add('menuScene2', menuScene2);
game.scene.add('menuScene3', menuScene3);
game.scene.add('menuScene4', menuScene4);
game.scene.add('menuScene5', menuScene5);
game.scene.add('menuScene6', menuScene6);

game.scene.add('playScene1', playScene1);
game.scene.add('playScene2', playScene2);
game.scene.add('playScene3', playScene3);
game.scene.add('playScene4', playScene4);
game.scene.add('playScene5', playScene5);

game.scene.start('titleScene');
</script>
</body>
</html>